<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 	  layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>tbl_reply</title>
</head>
<body>
 <div layout:fragment="content">
	<h3>댓글목록</h3>
 	<table>
		<thead>
			<tr>
				<th>NO.</th>
				<th>board_no</th>
				<th>댓글내용</th>
				<th>작성자</th>
				<th>작성일자</th>
				<th>수정일자</th>
			</tr>
		</thead>
		<tbody id="replylist">
			<!-- <tr>
				<td>1</td>
				<td>1</td>
				<td>첫번째</td>
				<td>홍길동</td>
				<td>2024-03-18</td>
				<td>2024-03-18</td>
			</tr> -->
		</tbody>
	</table>
	
	<!-- 페이징 타임리프말고 하는 거 찾아보기 -->
	5건씩 최신순으로 정렬(페이징넣기)
	
	<br>
	
	<h3>사원(등록, 조회)</h3>
	<!-- ajax는 form action속성 사용 X & button type="button"으로(아니면 기본 submit이라 실행X) -->
	<form method="post" name="frm"> 
		글번호 <input name="bno"><br><br>
		댓글  <input name="reply"><br><br>
		작성자 <input name="replyer">
		<button type="button" onclick="saveReq()">등록</button>
	</form>
 
 
<script>
//댓글리스트 요청
listReq();

//댓글리스트 함수로 (등록삭제 등 처리 후 append로 후처리 못하겠으면 리스트만 다시 재로드)
function listReq() {
	//아직bno 연결X
	let bno = 1;
	//fetch("/replyList?bno="+1)
	fetch(`/replyList?bno=${bno}`)
	.then(res => res.json())
	.then(res => listRes(res));
}
/* function listReq() {
	//아직bno 연결X
	//fetch(`/replyList/${bno}`)
	fetch("/reply/list/"+1)
	.then(res => res.json())
	.then(res => listRes(res));
} */
/* function listReq() {
	fetch("/replyList")
	.then(res => res.json())
	.then(res => listRes(res));
} */

//댓글리스트 응답
function listRes(res) {
	console.log(res); //빈배열
	
	for(obj of res) {
		//table body 삽입
		let newTag = 
		`<tr>
			<td>${obj.rno}</td>
			<td>${obj.bno}</td>
			<td>${obj.reply}</td>
			<td>${obj.replyer}</td>
			<td>${dateFormat(obj.replyDate)}</td>
			<td>${dateFormat(obj.updateDate)}</td>
		 </tr>`
		 
		 replylist.innerHTML += newTag;
	}
}
//날짜format
function dateFormat(dt) {
		console.log(dt);
		let date = new Date(dt);
		
		let year = date.getFullYear();
		let month = ( 1 + date.getMonth() );
		let day = date.getDate();
		
		month = month >= 10 ? month : '0' + month; //10미만일 시 앞에 0을 붙혀서 저장
		day = day >= 10 ? day : '0' + day;
		
		return `${year}년 ${month}월 ${day}일`;
}
//페이징
/* function gopage(p){
	frmSearch.page.value = p; //넘겨줄 값 여러 개면 form으로 넘겨주기
	frmSearch.submit();
}

function init() {
	frmSearch.departmentId.value=""
	frmSearch.firstName.value=""
	frmSearch.managerId.value=""
} */

//등록요청
function saveReq() {
	const bno = frm.bno.value;
	const reply = frm.reply.value;
	const replyer = frm.replyer.value;
	
	let param = {bno, reply, replyer}
	fetch("/reply", { 
		method : "post",
		headers: {
			"Content-Type": "application/json",
		    },
		body : JSON.stringify(param)
		
	})
	.then(res => res.json())
	.then(res => saveRes(res))
}

//등록응답
function saveRes(res) {
	//console.log(res)
	listReq();
}

</script>
 
 
 
 </div>
</body>
</html>

<style>
table, th, td {
	border: 2px solid #ccc;
	border-collapse: collapse;
	padding: 5px;
}
th {
	background: #eee
}

</style>